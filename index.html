<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden; /* 禁用全局滚动 */
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        /* 创建视口容器 */
        #viewport {
            position: relative;
            width: calc(100vw - 16px); /* 减去垂直滚动条宽度 */
            height: 100vh;
            overflow-x: hidden;
            overflow-y: scroll; /* 保留滚动功能 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        
        /* 隐藏WebKit浏览器的原生滚动条 */
        #viewport::-webkit-scrollbar {
            display: none;
        }
        
        /* 当水平滚动条显示时的视口样式 */
        #viewport.has-scrollbar {
            height: calc(100vh - 16px);
        }
        
        /* 缩放和拖动状态样式 */
        body.scaling {
            pointer-events: none; /* 缩放时禁用点击 */
        }
        
        body.dragging {
            cursor: grabbing !important;
            user-select: none !important;
        }
        
        body.dragging * {
            user-select: none !important;
        }
        
        body.resizing #image-container {
            transition: none !important; /* 禁用过渡效果 */
        }
        
        #image-container {
            position: absolute;
            left: 50%;
            top: 0;
            transform-origin: top center !important;
            transform: translateX(-50%); /* 默认居中 */
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            will-change: transform;
            backface-visibility: hidden;
        }
        
        #image-container.draggable {
            cursor: default; /* 改为默认箭头，而不是grab */
        }
        
        .image-wrapper {
            width: auto; /* 固定宽度而非百分比 */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 0;
            padding: 0;
            will-change: transform;
        }
        
        .seamless-image {
            width: auto;
            max-width: none; /* 取消最大宽度限制 */
            height: auto;
            display: block;
            margin: 0 auto;
            padding: 0;
        }
        
        /* 图片分割线和占位符样式 */
        .image-divider {
            width: 100%;
            height: 1px;
            background-color: rgba(0, 0, 0, 0.7);
            margin: 0;
            padding: 0;
        }
        
        .no-images {
            padding: 20px;
            text-align: center;
            color: #999;
        }
        
        /* 缩放级别显示 */
        #zoom-level {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            z-index: 1000;
            transition: opacity 0.5s ease;
            pointer-events: none;
            font-size: 14px;
            font-weight: bold;
        }
        
        /* 自定义滚动条容器 */
        #custom-scrollbar-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 16px;
            background-color: rgba(30, 30, 30, 0.7);
            z-index: 1000;
            display: none;
            overflow: hidden; /* 防止内容溢出 */
            opacity: 0; /* 默认隐藏 */
            transition: opacity 1.5s ease; /* 修改为1.5秒过渡效果 */
        }
        
        #custom-scrollbar {
            position: absolute;
            height: 8px;
            background-color: rgba(150, 150, 150, 0.7);
            border-radius: 4px;
            top: 4px;
            cursor: pointer;
            transform-origin: center;
            transition: height 0.1s ease-out;
        }
        
        /* 自定义滚动条拖动手柄 */
        #custom-scrollbar-handle {
            width: 100%;
            height: 100%;
            background-color: rgba(200, 200, 200, 0.9);
            border-radius: 4px;
            position: absolute;
        }
        
        /* 添加垂直滚动条容器和滚动条样式 */
        #vertical-scrollbar-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 16px;
            height: 100%;
            background-color: rgba(30, 30, 30, 0.7);
            z-index: 1000;
            overflow: hidden;
            opacity: 0; /* 默认隐藏 */
            transition: opacity 1.5s ease; /* 修改为1.5秒过渡效果 */
        }
        
        #vertical-scrollbar {
            position: absolute;
            width: 8px;
            background-color: rgba(150, 150, 150, 0.7);
            border-radius: 4px;
            left: 4px;
            cursor: pointer;
            transform-origin: center;
            transition: width 0.1s ease-out;
        }
        
        #vertical-scrollbar-handle {
            width: 100%;
            height: 100%;
            background-color: rgba(200, 200, 200, 0.9);
            border-radius: 4px;
            position: absolute;
        }
        
        /* 滚动条活动时的样式 */
        #custom-scrollbar-container.active,
        #vertical-scrollbar-container.active {
            opacity: 1;
        }
        
        /* 刷新按钮样式 - 更新为默认半透明 */
        #refresh-button {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(30, 30, 30, 0.3); /* 更低的不透明度 */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            opacity: 0.5; /* 默认半透明 */
        }
        
        #refresh-button:hover {
            background-color: rgba(50, 50, 50, 0.9);
            transform: scale(1.05);
            opacity: 1; /* 悬停时完全不透明 */
        }
        
        #refresh-button:active {
            transform: scale(0.95);
        }
        
        #refresh-button img {
            width: 24px;
            height: 24px;
        }
        
        /* 添加刷新动画 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #refresh-button.refreshing img {
            animation: spin 0.5s linear;
        }
        
        /* 刷新通知样式 */
        #refresh-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        #refresh-notification.success {
            background-color: rgba(46, 125, 50, 0.8);
        }
        
        #refresh-notification.info {
            background-color: rgba(25, 118, 210, 0.8);
        }
    </style>
</head>
<body>
    <div id="viewport">
        <div id="image-container"></div>
    </div>
    <div id="custom-scrollbar-container">
        <div id="custom-scrollbar">
            <div id="custom-scrollbar-handle"></div>
        </div>
    </div>
    <div id="vertical-scrollbar-container">
        <div id="vertical-scrollbar">
            <div id="vertical-scrollbar-handle"></div>
        </div>
    </div>
    
    <!-- 添加刷新按钮 -->
    <div id="refresh-button">
        <img src="refresh.png" alt="刷新" title="刷新图片" />
    </div>
    
    <script src="js/plugin.js"></script>
    <script>
        // 修改函数，移除所有与普通鼠标移动相关的滚动条显示
        function setupScrollbarVisibility() {
            // 只在滚动时显示滚动条
            const viewport = document.querySelector('#viewport');
            if (viewport) {
                viewport.addEventListener('scroll', showScrollbars);
            }
            
            // 其他触发操作保留，但不再监听普通mousemove
            document.addEventListener('mousedown', function(e) {
                if (e.target.closest('#image-container') || 
                    e.target.closest('#custom-scrollbar-container') ||
                    e.target.closest('#vertical-scrollbar-container')) {
                    showScrollbars();
                }
            });
            
            // 初始化时显示一次滚动条
            showScrollbars();
        }

        // 确保在处理滚动条拖动时不重复调用showScrollbars
        function handleScrollbarDrag(e) {
            if (!isDraggingScrollbar) return;
            
            // 原有的拖动逻辑保持不变
            // ...
            
            // 不要在这里调用showScrollbars()
            // 只在拖动开始时调用一次
        }

        // 同样，在鼠标移动时不要显示滚动条
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            // 原有的拖动逻辑保持不变
            // ...
            
            // 不要在这里调用showScrollbars()
            // 只在拖动开始时调用一次
        });

        // 确保所有已存在的mousemove事件处理器不会调用showScrollbars
        // 这需要检查并修改所有现有代码中的mousemove事件处理

        // 鼠标释放和拖动结束时重置隐藏计时器
        function endDrag() {
            if (!isDragging) return;
            isDragging = false;
            
            // 原有的结束拖动逻辑保持不变
            // ...
            
            // 重置计时器，让滚动条可以在交互结束后隐藏
            resetScrollbarHideTimer();
        }

        // 滚动条拖动结束
        function endScrollbarDrag() {
            if (!isDraggingScrollbar) return;
            isDraggingScrollbar = false;
            
            // 原有的结束拖动逻辑保持不变
            // ...
            
            // 重置计时器，让滚动条可以在交互结束后隐藏
            resetScrollbarHideTimer();
        }
    </script>
</body>
</html>